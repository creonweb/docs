# Стандарты написания кода при разработке сайтов на MODX Revolution
## Ссылки на документы:
> [мануал по использованию Fenom](https://habrahabr.ru/post/264635/) 

> [Руководство по использованию pdoTools](https://docs.modx.pro/components/pdotools/)

# Использование PDOTools и Fenom

Основными инструментами являются PDOTools и шаблонизатор Fenom.

Для создания меню, хлебных крошек, вывода ресурсов, создания карты сайта, вывода списка пользователей и так далее – должна использоваться библиотека PDOTools. С ее помощью можно решить большинство типовых задач. 

Все чанки и шаблоны должны быть описаны в синтаксисе шаблонизатора Fenom. Использование стандартного синтаксиса MODX допускается ТОЛЬКО ТОГДА, когда сниппет, под который написан чанк, не поддерживает PDOTools. Это относится, например, к Gallery и getImageList. 

Во всех остальных случаях использование стандартного синтаксиса **НЕДОПУСТИМО**. 

Все чанки, шаблоны, пользовательские сниппеты и плагины должны быть файлами, и не могут быть созданы через админку MODX (кроме тех, что должны быть зарегистрированы в системе). 

## Структура проекта

Все элементы хранятся в папке CORE_PATH. ‘elements/’ со следующей структурой (рис 1.)

![Риcунок 1](/img/pic1.png)
###### Рисунок 1. Расположение папок элементов.

Чанки хранятся в папке chunks и так же имеют свою структуру расположения (рис 2.)

![Риcунок 2](/img/pic2.png)
###### Рисунок 2. Структура расположения чанков

Все чанки создаются в IDE и имеют расширение **.tpl**.

Общие для всего сайта чанки (шапка, подвал, подключение стилей и скриптов, хлебные крошки) всегда хранятся в папке common.

Отдельные блоки сайта или отдельные функции хранятся в своих папках. Личный кабинет – office, поиск – search и так далее.

Все шаблоны форм хранятся в папке Forms. 

Вызовы форм так же желательно сохранять в отдельных чанках.

Все чанки, относящиеся к miniShop2 хранятся в папке Shop и так же разбиты по своим папкам.

В папке cart хранятся чанки-шаблоны вызовов msCart, msMiniCart, msOrder.

В папке category – вызов mFilter2 для создания раздела категории или же вызов другого сниппета, например, msProducts.

Папка filter, как правило, содержит в себе шаблоны категорий, а так же шаблоны внешнего вида отдельного вида фильтров. 

Папка product – содержит шаблоны, относящиеся непосредственно к товару:

* Чанк product.tpl заменяет чанк msProductContent
* Чанк product.row.tpl заменяет чанк tpl.msProducts.row
* Так же в этой папке могу содержаться шаблоны для вывода сниппетов, связанных с опциями товаров а так же с модификациями.  


## Именование чанков

В именовании чанков, шаблонов, сниппетов, плагинов запрещено использовать транслит. 

**Чанки вроде – kartochkaTovara.tpl не будут приняты!** 

Для более-менее корректного перевода можно воспользоваться Google-переводчиком.

При именовании элементов желательно использовать простые слова, которые максимально отражают суть элемента и его роль. 

Чанки, которые многократно используются на странице и выводят повторяющуюся информацию, именуются chunkname.row.tpl 

Наиболее правильным является именование по шаблону "используемый компонент.блок на сайте.что делает.tpl", примеры: 

* product.gallery.tpl - галерея товара
* product.tpl - главный чанк товара
* office.sidebar.login.tpl - чанк авторизации в сайдбаре
* office.sidebar.logout.tpl - чанк выхода в сайдбаре
* filter.checkbox.outer.tpl - чанк-обёртка для чекбокса в фильтре

## Нюансы шаблонов
Шаблонизатор Fenom поддерживает наследование шаблонов, подробнее об этом можно прочитать в документации к PDOTools. 
Смысл в том, что изначально используется базовый шаблон base.tpl, в котором уже описаны все блоки, которые потом расширяются. 
На рисунке изображены типичные шаблоны сайта, шаблон base.tpl – основной.

![Риcунок 3](/img/pic3.png)
###### Рисунок 3. Типичные шаблоны

### Типовая разметка базового шаблона
```php
<!doctype html>
<html>
    {block 'HEAD'}
        {include 'file:chunks/common/head.tpl'}
    {/block}
    <body>
        {block 'HEADER'}
            {include 'file:chunks/common/header.tpl'}
        {/block}
        {block 'BREADCRUMBS'}
            {include 'file:chunks/common/breadcrumbs.tpl'}
        {/block}        
        {block 'CONTENT'}
        {/block}
        {block 'FOOTER'}
            {include 'file:chunks/common/footer.tpl'}
        {/block}
        {block 'MODALS'}
            {include 'file:chunks/modals/modal.login.tpl'}
        {/block}
        {block 'SCRIPTS'}
            {*include 'file:chunks/common/scripts.tpl'*}
        {/block}
    </body>
</html>
```

Благодаря наследованию шаблонов, другие шаблоны выглядят очень просто и в них не нужно заново определять вызовы типовых элементов. 

### Типовой пример расширенного шаблона страницы на примере шаблона product.tpl

```php
{extends 'file:templates/base.tpl'}
{block 'CONTENT'}
    {include 'file:chunks/shop/product/product.tpl'}
{/block}
{block 'MODALS'}
    {parent}
    {include 'file:chunks/modals/modal.pickup.tpl'}
{/block}
```

## Использование сниппетов и компонентов
При разработке необходимо по-максимуму использовать функционал шаблонизатора Fenom и библиотеки pdoTools. 
Большинство нестандартных задач можно решить с помощью компонентов, находящихся в репозитории modstore.pro. 
При выборе очередного компонента необходимо убедится в том, что он поддерживает работу с PDOTools.

> **Однако, если компонент уникальный и не поддерживает работу с pdoTools, то его использование допустимо.**
> **Но необходимо согласовать с руководителем проекта**

> **Разработка магазинов ведется только с использованием MiniShop2!**

Запрещено использовать сниппеты:

* getPage (вместо него - pdoPage)
* getResources (вместо него - pdoResources)
* Wayfinder (вместо него - pdoMenu)
* getImageList (если не используется параметр WHERE)
* Breadcrumbs (вместо него - pdoCrumbs)
* If (вместо него - синтаксис Fenom)
* MinifyX (вместо него - работаем с Gulp)
* Phpthumbof (вместо него используется phpthumbon)
* pThumb (вместо него используется phpthumbon)
* GoogleSitemap (вместо него - pdoSitemap)
* Login (вместо него - всегда Office)

Запрещено использовать компоненты: 

* Quip (вместо него используется Tickets)

Если на сайте используется MIGX, то в таком случае, если не нужна дополнительная выборка по параметру WHERE, то тогда вывод контента можно осуществить с помощью шаблонизатора Fenom, модификатора **|fromJSON** и цикла foreach. 
При написании собственных сниппетов необходимо хранить их в папке snippets. 
Если сниппет возвращает результат в каком-то чанке или чанках, необходимо подключать PDOTools для того, чтобы была возможность работать с файловыми элементами:

```php
<?php
$pdo = $modx->getService('pdoTools');
$placeholder = 'someresult';
$output .= $pdo->getChunk(‘@FILE:chunks/somefolder/somechunk.tpl’,[
	‘placeholder’ => $placeholder
]);
return $output;
```

### Использование CSS и JS на сайте
Все скрипты и стили должны сшиваться в 1-2 файла app.min.css и app.min.js с помощью Gulp.
Базовая заготовка gulpfile и всего HTML проекта находится тут недалеко: 
> [https://github.com/creonweb/dummyhtml](https://github.com/creonweb/dummyhtml)

### Использование GIT
Одно из преимуществ работы с MODX через IDE и с помощью файловых элементов заключается в том, что почти весь код сайта можно сохранять с помощью системы контроля версий и не нагружать сайт дополнительным компонентом VersionX. 
Всегда при разработке сайта необходимо использовать GIT, и сохранять результаты работы на удаленный сервер GitHub или BitBucket для проверки и хранения.

Правило - готовый модуль, готовый элемент на сайте - коммит. Фикс какой-то баги - коммит.

То есть, сделали меню в шапке - коммит.

Добавили галерею к товару - коммит. 

Коммиты пишутся на английском языке. Русский нежелателен. 



